(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{267:function(t,e,r){"use strict";var n=r(36),o=r(38),i=r(115),a=r(268),c=r(269);n({target:"Promise",stat:!0},{allSettled:function(t){var e=this,r=i.f(e),n=r.resolve,s=r.reject,u=a((function(){var r=o(e.resolve),i=[],a=0,s=1;c(t,(function(t){var o=a++,c=!1;i.push(void 0),s++,r.call(e,t).then((function(t){c||(c=!0,i[o]={status:"fulfilled",value:t},--s||n(i))}),(function(t){c||(c=!0,i[o]={status:"rejected",reason:t},--s||n(i))}))})),--s||n(i)}));return u.error&&s(u.value),r.promise}})},268:function(t,e){t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},269:function(t,e,r){var n=r(12),o=r(270),i=r(114),a=r(116),c=r(117),s=r(74),u=r(271),l=function(t,e){this.stopped=t,this.result=e};t.exports=function(t,e,r){var f,d,p,h,w,m,g,v=r&&r.that,y=!(!r||!r.AS_ENTRIES),_=!(!r||!r.IS_ITERATOR),E=!(!r||!r.INTERRUPTED),S=a(e,v,1+y+E),R=function(t){return f&&u(f,"normal",t),new l(!0,t)},I=function(t){return y?(n(t),E?S(t[0],t[1],R):S(t[0],t[1])):E?S(t,R):S(t)};if(_)f=t;else{if(!(d=s(t)))throw TypeError(String(t)+" is not iterable");if(o(d)){for(p=0,h=i(t);h>p;p++)if((w=I(t[p]))&&w instanceof l)return w;return new l(!1)}f=c(t,d)}for(m=f.next;!(g=m.call(f)).done;){try{w=I(g.value)}catch(t){u(f,"throw",t)}if("object"==typeof w&&w&&w instanceof l)return w}return new l(!1)}},270:function(t,e,r){var n=r(8),o=r(39),i=n("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||a[i]===t)}},271:function(t,e,r){var n=r(12),o=r(58);t.exports=function(t,e,r){var i,a;n(t);try{if(!(i=o(t,"return"))){if("throw"===e)throw r;return r}i=i.call(t)}catch(t){a=!0,i=t}if("throw"===e)throw r;if(a)throw i;return n(i),r}},381:function(t,e,r){"use strict";r.r(e);r(267),r(4);var n=r(29),o=r(1),i=r(57);e.default=(t={})=>{const{gmcMerchantId:e,dialogPosition:r}=t;if(e){const t=window.storefrontApp&&window.storefrontApp.router;if(t){const a=({name:t,params:a})=>{if("confirmation"===t&&a.json){const t=t=>{const e=new Date(Date.now());return e.setDate(e.getDate()+t),e};let c,s,u,l;const f=decodeURIComponent(a.json);if(f)try{c=JSON.parse(f)}catch(t){}if(c){const{buyers:e}=c;e&&e[0]&&(s=e[0].main_email);const r=c.shipping_lines&&c.shipping_lines[0];if(r&&r.delivery_time){let e=r.delivery_time.days;r.posting_deadline&&(e+=r.delivery_time.days),r.delivery_time.working_days&&(e*=1.25),l=t(e+3)}}s||(s=i.a.getCustomer().main_email),u||(u=n.$ecomConfig.get("country_code")),l||(l=t(14));const d=[],p=[],h={merchant_id:e,order_id:a.number||a.id,email:s,delivery_country:u,estimated_delivery_date:l.getFullYear()+"-".concat((l.getMonth()+1).toString().padStart(2,"0"),"-")+l.getDate().toString().padStart(2,"0"),opt_in_style:r||"CENTER_DIALOG"};if(c&&c.items)for(let t=0;t<c.items.length&&t<=4;t++)d.push(Object(o.g)({url:"/products/".concat(c.items[t].product_id,".json")}).then((({data:t})=>{t.gtin&&t.gtin.forEach((t=>{p.includes(t)||p.push(t)}))})).catch(console.error));Promise.allSettled(d).then((()=>{p.length&&(h.products=p.map((t=>({gtin:t})))),window.gapi.load("surveyoptin",(function(){window.gapi.surveyoptin.render(h)}))}))}};t.currentRoute&&a(t.currentRoute),t.afterEach(a)}}else console.error(new Error("Can't show opt-in dialog without `gmcMerchantId` option"))}}}]);